# ArkTS高性能编程实践

不变的变量推荐使用const

number类型避免整型和浮点型混用，因为对于number类型，运行时在优化时会区分整型和浮点数，混用会降低优化的效果
```
let a = 1
a = 1.1
```

数值计算避免溢出，避免数值大于INT32_MAX，因为溢出之后，会导致引擎进入慢速的溢出逻辑处理分支，影响程序性能

提取循环中的常量，减少属性访问次数.例如循环中访问了常量Time.start，则可以将它提取设置为外部的常量

闭包会造成额外的开销，在性能敏感的场景，建议将闭包替换为函数参数

避免使用可选参数，因为函数内部使用该参数时需要进行非空判断，造成额外的开销，建议使用必选参数和默认值的方式

数值数组推荐使用类型更明确的TypedArray，因为针对更明确的类型，可以有更细致的优化，例如将`new Array<number>(1,2,3)`替换为`Int8Array.from([1, 2, 3])`

避免使用稀疏数组。稀疏数组对应的是密集数组，密集数组分配的内存区域是连续的。当密集数组中出现大量的无效hole时，会造成大量的空间浪费，尤其是在数组元素过多的时候。这个时候为了节省内存空间，一般会将密集数组降级为稀疏数组，通过hash表来存储访问元素。也就是说，稀疏数组中只存储真正有用的数据，不存在大量无效的hole，可以有效的节省空间。但是对于程序中被高频调用，对性能要求较高的场景下，如果实际数组大小可控，应该尽量避免使用稀疏数组，因为相比直接访问数组元素，通过hash表来存储和访问元素会造成一定的开销，主要在于hash值的计算以及hash表的查找。在ArkTS中，如果数组元素超过了1024个就会自动变为稀疏数组。

避免使用联合类型数组以及避免混用整型和浮点型

避免频繁抛出异常，尤其是在循环语句中，因为创建异常时，需要构造异常的栈帧，有一定的性能损耗
